# VelocityGuard
![VelocityGuard CI with Maven + Spigot](https://github.com/orion-tran/VelocityGuard/workflows/VelocityGuard%20CI%20with%20Maven%20+%20Spigot/badge.svg?branch=master)

VelocityGuard is a port of the amazing plugin 
[BungeeGuard](https://github.com/lucko/BungeeGuard) and functions the same way.
VelocityGuard is a pair of plugins that uses the GameProfile of a player to
verify whether a player is connected from a trusted Velocity instance or not.

 * On Velocity, VelocityGuard inserts a special authentication token into
   GameProfile data which, when sent to a backend server will be verified
   when a player attempts to connect.
 * On the backend instance, VelocityGuard listens for players logging in
   and retrieves GameProfile data and verifies the token is not only present
   but is on the list of authorized tokens allowed to connect.

What all of this does is it allows absolutely no one to join (even through a
proxy server) without knowing a correct, authorized token.

## Common issues (read this before continuing)
* **Please don't confuse VelocityGuard with Velocity's built in modern forwarding, VelocityGuard is meant to solve a completely different problem**

* The best way to have VelocityGuard set up is to have your Velocity instance have it's forwarding mode set to `legacy` and have your backend server's `bungeecord` mode enabled.

* If you're using PaperSpigot please do **NOT** use the `paper.yml` `velocity-support` configuration entry as it's not the same thing as VelocityGuard.

## Download
Download the latest release of VelocityGuard through the releases tab in GitHub!

## Installation

#### On your Velocity proxies

1. Copy the `velocityguard-proxy.jar` file to the Velocity `plugins` folder
   and then proceed to restart the proxy. 
   
2. Inside the `plugins` folder there should be a new folder called
   `velocityguard`. Open the file called `token.json` inside the
   `velocityguard` folder and copy down the value of `token` (Your token 
   should be 64 characters long).

#### On each of your servers

1. Copy the `velocityguard-backend.jar` file into your `plugins` folder and
   restart the server.

2. Inside the `plugins` folder (or the config directory for the Sponge users) 
   there should be a new folder called `velocityguard`. Open the file 
   `config.yml` inside the `velocityguard` folder. 

3. Add the token(s) generated by your proxy(-ies) to the `allowed-tokens` list.
   
   e.g.
   ```yaml
   # Put the allowed authentication tokens in the list below
   
   allowed-tokens:
     - "gpZCEOe9u0p4KKV8Tgf1TxDrE5ZzcOCfs3JunDi82CvRuHQgeCoxKUladkYDTyBb"
   ```

4. Restart the server.

**Please donâ€™t ask the Velocity Discord for help, this is not an official velocity-made plugin so they cannot offer the same level of support**
